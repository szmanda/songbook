<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Śpiewnik Gitarkowy</title>
    <link rel="stylesheet" href="styles.css">
    <script>globalThis.songs = [];</script>
    <script src="./songs/NicWięcej.js"></script>
    <script src="./songs/Lipka.js"></script>
    <script src="./songs/Kamienie.js"></script>
</head>
<body>
    <!-- Form for layout changes -->
    <div class="screen">
        <details>
            <summary>Layout Options</summary>
            <form>
                <label for="columns">Columns:</label>
                <input type="number" id="columns" name="columns" value="2" min="1">
                <label for="rows">Rows:</label>
                <input type="number" id="rows" name="rows" value="2" min="1">
                <label for="width">Width:</label>
                <input type="number" id="width" name="width" value="297" min="25">
                <label for="height">Height:</label>
                <input type="number" id="height" name="height" value="210" min="25">
                <label for="fontSize">Font Size:</label>
                <input type="number" id="fontSize" name="fontSize" value="11" min="1">
                <label for="lines">Lines:</label>
                <input type="number" id="lines" name="lines" value="32" min="1">
                <label for="ordFront">Page Order front:</label>
                <input type="text" id="ordFront" name="pages" value="1,-1,3,-3">
                <!-- <input type="text" id="ordFront" name="pages" value="1,2,3,4,5,6"> -->
                <label for="ordBack">Page Order back:</label>
                <input type="text" id="ordBack" name="pages" value="2,-2,4,-4">
                <!-- <input type="text" id="ordBack" name="pages" value="7,8,9,10,11,12"> -->
                <input type="button" value="Refresh" onclick="refresh()">
            </form>
        </details>
    </div>

    <!-- Hidden source content, loaded and paginated -->
    <div id="source-content" class="hidden"></div>

    <!-- Displayed final version -->
    <div id="sheet-outer" class="sheet-outer"></div>

    <script src="./reformat.js"></script>
    <script src="./resize.js"></script>
    <script src="./parse.js"></script>

    <script>
        var loadSongs = function (linesPerPage = 41) {
            document.getElementById('source-content').innerHTML = '';
            Object.keys(globalThis.songs).forEach(song => {                
                parseSong('source-content', globalThis.songs[song], linesPerPage);
            });
        }
        
        var refresh = function () {
            const columns = document.getElementById('columns').value;
            const rows = document.getElementById('rows').value;
            const width = document.getElementById('width').value;
            const height = document.getElementById('height').value;
            const perPage = columns * rows;
            const ordFront = document.getElementById('ordFront').value.split(',').map(Number).splice(0, perPage);
            const ordBack = document.getElementById('ordBack').value.split(',').map(Number).splice(0, perPage);
            const fontSize = document.getElementById('fontSize').value + 'px';
            const linesPerPage = document.getElementById('lines').value;
            loadSongs(linesPerPage);
            document.body.style.fontSize = fontSize;
            reformatToPages('.content-page', perPage, ordFront, ordBack);
            setSectionGrid('.sheet', columns, rows, width, height);
        }

        refresh();
    </script>
</body>
</html>